
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Training &#8212; Dext-Gen 0.1 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="envs" href="../envs/envs.html" />
    <link rel="prev" title="Setup" href="setup.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dext-Gen 0.1 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Setup
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Training
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/envs.html">
   envs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/parallel_jaw.html">
   envs.parallel_jaw
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/barrett_hand.html">
   envs.barrett_hand
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/shadow_hand.html">
   envs.shadow_hand
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/rotations.html">
   envs.rotations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../envs/utils.html">
   envs.utils
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Learning Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.html">
   mp_rl.core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.actor.html">
   core.actor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.critic.html">
   core.critic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.ddpg.html">
   core.ddpg
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.noise.html">
   core.noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.normalizer.html">
   core.normalizer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.replay_buffer.html">
   core.replay_buffer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mp_rl/core.utils.html">
   core.utils
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notes/acknowledgements.html">
   Acknowledgements
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/amacati/rl"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/getting_started/training.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configuring-experiments">
   Configuring experiments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-an-experiment">
   Running an experiment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-training">
   Pre-training
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes-on-distributed-training">
   Notes on distributed training
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Training</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configuring-experiments">
   Configuring experiments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-an-experiment">
   Running an experiment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-training">
   Pre-training
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes-on-distributed-training">
   Notes on distributed training
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="training">
<span id="id1"></span><h1>Training<a class="headerlink" href="#training" title="Permalink to this headline">#</a></h1>
<p>After installing the package and all its dependencies, you can run the simulations and train agents to solve the different grasping scenarios.
You can expect training speeds to vary from a few hours to days depending on your hyperparameter configuration, hardware setup and task difficulty.</p>
<section id="configuring-experiments">
<h2>Configuring experiments<a class="headerlink" href="#configuring-experiments" title="Permalink to this headline">#</a></h2>
<p>All experiments can be configured in the <code class="docutils literal notranslate"><span class="pre">config/experiment_config.yaml</span></code> file. The top <code class="docutils literal notranslate"><span class="pre">Default</span></code> key contains default settings that are applied to all experiments.
To add changes for a single environment, you can add the environment’s name as a key to the config file. Settings under the explicit environment name overwrite the default values.
For some environments such as the ShadowHand simulations, additional parameters can be passed to the environment on initialization. These parameters should be included in the
individual experiment configuration under the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For reproducible experiments, do <strong>not</strong> set the <code class="docutils literal notranslate"><span class="pre">seed</span></code> argument to 0, as this seed will be ignored.</p>
</div>
</section>
<section id="running-an-experiment">
<h2>Running an experiment<a class="headerlink" href="#running-an-experiment" title="Permalink to this headline">#</a></h2>
<p>All experiments are started by launching <code class="docutils literal notranslate"><span class="pre">main.py</span></code> with <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> and the environment’s name as argument. As an example, to launch the ShadowHand mesh grasp experiment,
the following command has to be executed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mpirun -n <span class="m">16</span> python main.py --env FlatSHMesh-v0
</pre></div>
</div>
<p>You can control the number of MPI nodes with the <code class="docutils literal notranslate"><span class="pre">-n</span></code> argument. The environment name is passed with the <code class="docutils literal notranslate"><span class="pre">--env</span></code> agument. A list of the available environments can be found in the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file of the <code class="docutils literal notranslate"><span class="pre">envs</span></code> module.
Be sure to configure your experiment before launching the training nodes.</p>
<p>If you do not have access to 16 physical cores but only 16 hardware threads, you can launch MPI with the hardware thread option enabled.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mpirun -n <span class="m">16</span> --use-hwthread-cpus python main.py --env FlatSHMesh-v0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Changing the number of MPI nodes will result in different computation times and training performance. We recommend the use of 16 nodes in all experiments.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do <strong>not</strong> use python to launch the training. Doing so will not launch the required nodes and result in vastly different training results and computation times.</p>
</div>
<p>Please make sure the appropriate conda environment has been activated and all necessary environment variables are set (see <a class="reference internal" href="setup.html#setup"><span class="std std-ref">Setup</span></a>).</p>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h2>
<p>During training the results are saved to the saves folder in the root directory. The saves are further categorized into folders by their environment name.
The top level of an environment’s save folder contains the latest network and normalizer checkpoints, as well as the current training progress plot and the current training statistics as a JSON file for convenient access during training.
The <code class="docutils literal notranslate"><span class="pre">stats.json</span></code> file also contains the configuration parameters of the current experiment. If several environments are trained concurrently, saves from different experiments overwrite each other. For this reason, each experiment also saves checkpoints
of the training progress to a folder under <code class="docutils literal notranslate"><span class="pre">backup</span></code> named after the date and time at the experiment start. These backup saves only contain the training statistics, not the full networks. The final networks and normalizers are saved to the backup folder once training has finished.</p>
</section>
<section id="pre-training">
<h2>Pre-training<a class="headerlink" href="#pre-training" title="Permalink to this headline">#</a></h2>
<p>Instead of training from scratch, networks can be initialized by previously trained agents. To enable network loading, use the <code class="docutils literal notranslate"><span class="pre">load_pretrained</span></code> option in the experiment configuration.
Pretrained networks are loaded from the <code class="docutils literal notranslate"><span class="pre">saves/pretrain</span></code> folder. If a folder exists that matches the name of the environment directly, networks are loaded from this directory. Otherwise loading falls to the networks saved under <code class="docutils literal notranslate"><span class="pre">saves/pretrain/&lt;gripper_name&gt;</span></code>. Available gripper names are
<code class="docutils literal notranslate"><span class="pre">ParallelJaw</span></code>, <code class="docutils literal notranslate"><span class="pre">BarrettHand</span></code> and <code class="docutils literal notranslate"><span class="pre">ShadowHand</span></code>.</p>
<p>In order to successfully load a pretrained agent, the pretrain save directory must contain four files, namely the actor network <code class="docutils literal notranslate"><span class="pre">actor.pt</span></code>, the critic network <code class="docutils literal notranslate"><span class="pre">critic.pt</span></code>,
the state normalizer <code class="docutils literal notranslate"><span class="pre">state_norm.pkl</span></code> and the goal normalizer <code class="docutils literal notranslate"><span class="pre">goal_norm.pkl</span></code>.</p>
</section>
<section id="notes-on-distributed-training">
<h2>Notes on distributed training<a class="headerlink" href="#notes-on-distributed-training" title="Permalink to this headline">#</a></h2>
<p>We use MPI to average the network gradients across the nodes. In general, <code class="docutils literal notranslate"><span class="pre">torch.distributed</span></code> and in particular <code class="docutils literal notranslate"><span class="pre">torch.nn.parallel.DistributedDataParallel</span></code> was developed to take care of this task.
However, we saw significant speed differences between torch’s Gloo backend and manually managing the gradients with MPI. In theory, torch can be built with MPI as backend, however we opted for keeping the installation as
easy as possible. Furthermore, since the employed neural nets are small in total size, there is no speed gain in moving the network calculations to a GPU. If deeper nets are desired, it is recommended to revisit the
decision to train on CPUs only and move to GPUs. If possible, this should go hand in hand with a switch to torch’s <code class="docutils literal notranslate"><span class="pre">DDP</span></code> with <code class="docutils literal notranslate"><span class="pre">NCCL</span></code> backend.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="setup.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Setup</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../envs/envs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">envs</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Martin Schuck<br/>
  
      &copy; Copyright 2022, Martin Schuck.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>